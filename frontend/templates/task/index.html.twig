{% extends 'base.html.twig' %}

{% block title %}To-Do List{% endblock %}

{% block body %}
<div class="container py-5">
  <h1 class="mb-4">Ma To-Do List</h1>

  <div class="input-group mb-4">
    <input type="text" id="taskInput" class="form-control" placeholder="Nouvelle tâche">
    <button class="btn btn-primary" onclick="addTask()">Ajouter</button>
  </div>

  <div id="taskList" class="row g-3">
    <!-- Les tâches seront affichées ici -->
  </div>
</div>

<script>
const API_URL = "/api/tasks";

async function loadTasks() {
  const response = await fetch(API_URL);
  const tasks = await response.json();
  const taskList = document.getElementById("taskList");
  taskList.innerHTML = "";

  tasks.forEach(task => {
    const col = document.createElement("div");
    col.className = "col-md-4";

    const card = document.createElement("div");
    card.className = "card shadow-sm";
    card.style.borderLeft = task.completed ? "5px solid green" : "5px solid #ccc";

    const cardBody = document.createElement("div");
    cardBody.className = "card-body d-flex justify-content-between align-items-center";

    const title = document.createElement("span");
    title.textContent = task.title;
    if (task.completed) {
      title.style.textDecoration = "line-through";
      title.style.color = "green";
    }

    const btnGroup = document.createElement("div");

    const checkBtn = document.createElement("button");
    checkBtn.className = "btn btn-success btn-sm me-2";
    checkBtn.innerHTML = "✔️";
    checkBtn.onclick = () => toggleComplete(task);

    const delBtn = document.createElement("button");
    delBtn.className = "btn btn-danger btn-sm";
    delBtn.innerHTML = "❌";
    delBtn.onclick = () => deleteTask(task.id);

    btnGroup.appendChild(checkBtn);
    btnGroup.appendChild(delBtn);

    cardBody.appendChild(title);
    cardBody.appendChild(btnGroup);
    card.appendChild(cardBody);
    col.appendChild(card);
    taskList.appendChild(col);
  });
}

async function addTask() {
  const input = document.getElementById("taskInput");
  const title = input.value.trim();
  if (!title) return;

  await fetch(API_URL, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ title, completed: false })
  });

  input.value = "";
  loadTasks();
}

async function deleteTask(id) {
  await fetch(`${API_URL}/${id}`, { method: "DELETE" });
  loadTasks();
}

async function toggleComplete(task) {
  await fetch(`${API_URL}/${task.id}`, {
    method: "PUT",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ ...task, completed: !task.completed })
  });
  loadTasks();
}

window.onload = loadTasks;
</script>
{% endblock %}
